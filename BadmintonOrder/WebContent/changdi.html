<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
   
    <!-- Font-Awesome -->
    <link rel="stylesheet" href="css/font-awesome/css/font-awesome.min.css">

    <!-- Google Webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600|PT+Serif:400,400italic' rel='stylesheet' type='text/css'>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css" id="theme-styles">

    <!--[if lt IE 9]>      
        <script src="js/respond.js"></script>
    <![endif]-->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/modernizr.js"></script>
    <script src="vendors/bootstrap/dist/js/bootstrap-paginator.min.js"></script>
    <script type="text/javascript">
    var userid;
    function quit(){
    	$.ajax({
    		type : "POST",
    		dataType : "json",
    		url : "user/quit",
    		data : {
    			"id" : userid
    		},
    		success : function(data) {
    			if(data > 0){
    				alert("注销成功");
    				$("#modal-container-170348").modal("toggle");
    				location.reload();
    			}
    		}
    	});
    }
    $(document).ready(function() {
    	$.ajax({
    		type : "POST",
    		dataType : "json",
    		url : "user/islogin",
    		success : function(data) {
    			if (data.data == null) {
    				$("#logmsg").hide();
    				$("#quit").hide();
    				$("#chakanyue").hide();
    			} else {
    				userid = data.data.id;
    				$("#reg").hide();
    				$("#log").hide();
    				$("#msg").html("欢迎"+data.data.username);
    				$("#myyue").val(data.data.money);
    			}
    		}
    	});
    	initTable();
    });
    function initTable() {
		$.ajax({
			type : 'POST',
			dataType : "json",
			url : "changdi/selectwithpage",
			data : {
				"currentPage" : 1,
				"pageSize" : 9
			},
			success : function(data) {
				var result = data.data;
				var tbody1 = '<div class="row">';
				var tbody2 = '<div class="row">';
				var tbody3 = '<div class="row">';
				for(var i = 0; i < result.length; i++){
					if (i >= 0 && i < 3) {
						tbody1 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+result[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+result[i].id+'">'+result[i].name+'</a></h3><span class="meta">'+result[i].introduce+'</span><hr></header></article></div>';
					}
					if(i >= 3 && i < 6){
						tbody2 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+result[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+result[i].id+'">'+result[i].name+'</a></h3><span class="meta">'+result[i].introduce+'</span><hr></header></article></div>';
					}
					if(i >= 6 && i < 9){
						tbody3 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+result[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+result[i].id+'">'+result[i].name+'</a></h3><span class="meta">'+result[i].introduce+'</span><hr></header></article></div>';
					}
				}
				tbody1 += '</div>';
				tbody2 += '</div>';
				tbody3 += '</div>';
				$("#table").html(tbody1 + tbody2 + tbody3);

				var pageSize = data.pageSize;
				var pageCount = data.pageCount;
				var currentPage = data.currentPage;
				var options = {
					currentPage : currentPage,
					totalPages : pageCount,
					size : "normal",
					bootstrapMajorVersion : 3,
					alignment : "right",
					numberOfPages : pageSize,
					itemTexts : function(type, page, current) {
						switch (type) {
						case "first":
							return "首页";
						case "prev":
							return "上一页";
						case "next":
							return "下一页";
						case "last":
							return "末页";
						case "page":
							return page;
						}
					},
					//点击事件，用于通过Ajax来刷新整个list列表
					onPageClicked : function(event, originalEvent, type, page) {
						$.ajax({
							type : 'POST',
							dataType : "json",
							url : "changdi/selectwithpage",
							data : {
								"currentPage" : page,
								"pageSize" : pageSize
							},
							success : function(data) {
								var resultwithpage = data.data;
								var tbodywithpage1 = '<div class="row">';
								var tbodywithpage2 = '<div class="row">';
								var tbodywithpage3 = '<div class="row">';
								for(var i = 0; i < resultwithpage.length; i++){
									if (i >= 0 && i < 3) {
										tbodywithpage1 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+resultwithpage[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+resultwithpage[i].id+'">'+resultwithpage[i].name+'</a></h3><span class="meta">'+resultwithpage[i].introduce+'</span><hr></header></article></div>';
									}
									if(i >= 3 && i < 6){
										tbodywithpage2 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+resultwithpage[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+resultwithpage[i].id+'">'+resultwithpage[i].name+'</a></h3><span class="meta">'+resultwithpage[i].introduce+'</span><hr></header></article></div>';
									}
									if(i >= 6 && i < 9){
										tbodywithpage3 += '<div class="col-md-4 col-sm-4"><article class=" blog-teaser"><header><img src="'+resultwithpage[i].pic+'" alt=""><h3><a href="changdi_detail.html?id='+resultwithpage[i].id+'">'+resultwithpage[i].name+'</a></h3><span class="meta">'+resultwithpage[i].introduce+'</span><hr></header></article></div>';
									}
								}
								$("#table").html(tbodywithpage1 + tbodywithpage2 + tbodywithpage3);
							}
						});
					}
				};
				$('#pageLimit').bootstrapPaginator(options);
			}
		});
	}
    function quit(){
    	$.ajax({
    		type : "POST",
    		dataType : "json",
    		url : "user/quit",
    		data : {
    			"id" : userid
    		},
    		success : function(data) {
    			if(data > 0){
    				alert("注销成功");
    				$("#modal-container-170348").modal("toggle");
    				location.reload();
    			}
    		}
    	});
    }
    </script>
</head>
<body>
    <header>
        <div class="widewrapper subheader">
            <div class="container">
                <nav class="pull-right clean-nav">
                    <div class="collapse navbar-collapse">
                        <ul class="nav nav-pills navbar-nav">
                            <li>
                                <a href="index.html">首页</a>
                            </li>
                            <li>
                                <a href="changdi.html">场地列表</a>
                            </li>
                            <li>
                                <a href="chongzhi.html">账户充值</a>
                            </li>
                            <li>
                                <a href="mydingdan.html">我的预定</a>
                            </li>
                            <li>
                                <a href="userinfo.html">修改个人信息</a>
                            </li>
                            <li id = "reg">
                                <a href="register.html">注册</a>
                            </li>  
                            <li id = "log">
                                <a href="userLogin.html">登录</a>
                            </li>
                            <li id = "quit">
                                <a href="#modal-container-170348" data-toggle="modal">注销</a>
                            </li>
                            <li id = "rlogin">
                                <a href="rootLogin.html">后台登录</a>
                            </li>
                            <li id = "chakanyue">
                                <a href="#modal-container-770346" data-toggle="modal">查看余额</a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <p id = "msg" style = "margin-left:-50px;margin-top:20px"></p>
            </div>
        </div>
    </header>

    <div class="widewrapper main">
        <div class="container">
            <div class="row">
                <div class="col-md-12 blog-main" id = "table">
                    
                </div>
                <div id="example" style="text-align: right">
					<ul id="pageLimit"></ul>
				</div>
            </div>
        </div>
    </div>

   <footer>
        <div class="widewrapper footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 footer-widget">
                       <h3> <i class="fa fa-user"></i>地址</h3>
                       <p>啪啪啪啪啪路啪啪啪啪街啪啪啪啪啪啪号</p>
                    </div>

                    <div class="col-md-4 footer-widget">
                        <h3> <i class="fa fa-envelope"></i>联系方式</h3>
                        <p>18301057019</p>
                    </div>
                   
                </div>
            </div>
        </div>
    </footer>
    <!-- 查看余额 -->
	<div class="container">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<div class="modal fade" id="modal-container-770346" role="dialog"
					aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-hidden="true">×</button>
								<h4 class="modal-title" id="myModalLabel">我的余额</h4>
							</div>
							<div class="modal-body">
								<label for="exampleInputEmail1">我的余额</label>
								<input type="text" name="myyue" id="myyue" readonly class="form-control input-lg">
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">关闭</button>
								<button type="button" class="btn btn-primary" id="remove">确认</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 注销 -->
	<div class="container">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<div class="modal fade" id="modal-container-170348" role="dialog"
					aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-hidden="true">×</button>
								<h4 class="modal-title" id="myModalLabel">注销</h4>
							</div>
							<div class="modal-body">
								<p id="delete">确认注销？</p>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">关闭</button>
								<button type="button" class="btn btn-primary" id="quit" onclick="quit()">确认</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>